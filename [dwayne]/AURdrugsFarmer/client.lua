local drugsFarmerCol =  createColRectangle( 677, 1952, 51, 57)local testarea = createRadarArea ( 677, 1952, 51, 57, 0, 0, 0 )local antiSpamTimerlocal antiSpamTimer = nillocal drugsCrops = {}local sWidth,sHeight = guiGetScreenSize()local Width,Height = 400,400local X = (sWidth/2) - (Width/2)local Y = (sHeight/2) - (Height/2)local screenX, screenY = guiGetScreenSize()local harvestTimerFFS = 120000setElementData(localPlayer, "DrugsPlanted", 0)function isPlayerOnFarm()	if (isElementWithinColShape(localPlayer, drugsFarmerCol)) then		return true	else		return false	endendpositions = {}function farmingDrugs(cmd, value)	if isElementWithinColShape(localPlayer,drugsFarmerCol) then		if getElementData(localPlayer,"Occupation") == "Drugs farmer" then		if getElementData(localPlayer,"wantedPoints") > 600 then exports.NGCdxmsg:createNewDxMessage("You have more than 600 wanted points, you can't work on this job at the moment!",255,0,0) return false end		if getElementData(localPlayer,"isPlayerJailed") == true then return false end		if getElementData(localPlayer,"isPlayerArrested") == true then return false end		if not value then exports.NGCdxmsg:createNewDxMessage("Drugs available to plant: Ritalin, Weed, LSD, Cocaine, Ecstasy and Heroine",255,0,0) return false end		value = tostring(string.lower(value))		if value == "ritalin" then			drugsType = "Ritalin"		elseif value == "ecstasy" then			drugsType = "Ecstasy"		elseif value == "heroine" then			drugsType = "Heroine"		elseif value == "weed" then			drugsType = "Weed"		elseif value == "lsd" then			drugsType = "LSD"		elseif value == "cocaine" then			drugsType = "Cocaine"		else			exports.NGCdxmsg:createNewDxMessage("Drugs available to plant: Ritalin, Weed, LSD, Cocaine, Ecstasy and Heroine", 255, 0, 0) return false		end		if isTimer(antiSpamTimer) then return false end		antiSpamTimer = setTimer(function()  end,4000,1)		if isPedInVehicle(localPlayer)==true then return false end			local Planted = getElementData(localPlayer,"DrugsPlanted")			if Planted < 5 then				setElementData(localPlayer, "DrugsPlanted", getElementData(localPlayer, "DrugsPlanted") + 1)				setPedAnimation(localPlayer, "BOMBER", "BOM_Plant", nil, nil)				setTimer(setPedAnimation, 2500, 1, localPlayer, false)				setTimer(					function (x, y, z)						table.insert(drugsCrops,{})						local cropID = #drugsCrops						local x, y, z = getElementPosition ( localPlayer )						local fullPlant = createObject ( 3409, x, y, z-1 )						local fullblip = createBlip ( x,y,z,0,0,255,0 )						drugsCrops[cropID].plantObject = fullPlant						drugsCrops[cropID].plantObjects = fullblip						setElementData(drugsCrops[cropID].plantObject,"drugsType",drugsType)						drugsCrops[cropID].colShape = createColCircle(x, y, 2)						setElementData(drugsCrops[cropID].colShape,"drugsType",drugsType)						addEventHandler("onClientColShapeHit",drugsCrops[cropID].colShape,onCropColHit)						setObjectScale(fullPlant,0.2)						drugsCrops[cropID].timer = setTimer(							function (col)								setElementData(col,"harvest",true)								setObjectScale(fullPlant,1)							end, harvestTimerFFS, 1, drugsCrops[cropID].colShape						)						table.insert(positions,{x,y,z})					end, 1000, 1, x, y, z				)			else				exports.NGCdxmsg:createNewDxMessage("You have already planted 5 plants wait until plants grown up.", 255,255,0)			end		end	endendaddCommandHandler("plant", farmingDrugs)function setON()if getElementData(localPlayer,"Occupation") == "Drugs farmer" then	for i=1,#positions do		local mX, mY, mZ = positions[i][1], positions[i][2], positions[i][3]		local x, y, z = getElementPosition(localPlayer)		local sx, sy = getScreenFromWorldPosition(mX, mY, mZ)		if (sx) and (sy) then			local distance = getDistanceBetweenPoints3D(x, y, z, mX, mY, mZ)			if (distance < 30) then				local cropID					if isTimer(drugsCrops[i].timer) then						local timeLeft, timeLeftEx, timeTotalEx = getTimerDetails (drugsCrops[i].timer)						local timeLeft = math.floor(timeLeft / 1000)						local dtype = getElementData(drugsCrops[i].colShape,"drugsType")						if not dtype then return false end						if timeLeft and timeLeft > 0 then						if timeLeft > 90 then						r,g,b = 255,0,0						elseif timeLeft > 50 and timeLeft <= 90 then						r,g,b = 255,150,0						elseif timeLeft > 20 and timeLeft <= 50 then						r,g,b = 255,255,0						elseif timeLeft <= 20 then						r,g,b = 0,255,0						end						dxDrawText("Time left to Harvest "..dtype.." : "..tostring(timeLeft).." seconds!", sx+6, sy+6, sx, sy, tocolor(0,0,0, 255), 1.5-(distance/20), "bankgothic", "center", "center")						dxDrawText("Time left to Harvest "..dtype.." : "..tostring(timeLeft).." seconds!", sx, sy, sx, sy, tocolor(0,0,0, 255), 1.5-(distance/20), "bankgothic", "center", "center")						dxDrawText("Time left to Harvest "..dtype.." : "..tostring(timeLeft).." seconds!", sx+2, sy+2, sx, sy, tocolor(r,g,b, 255), 1.5-(distance/20), "bankgothic", "center", "center")					end				end			end		end    endendendaddEventHandler("onClientRender", root,setON)function onCropColHit(hitElement)	if hitElement == localPlayer then		if getElementData(localPlayer,"Occupation") == "Drugs farmer" then			if getElementData(source,"harvest") == true then				local cropID				local pX,pY,pZ				for i=1,#drugsCrops do					if source == drugsCrops[i].colShape then						cropID = i						destroyElement(source)						pX,pY,pZ = getElementPosition(drugsCrops[i].plantObject)						drugtype = getElementData(drugsCrops[i].plantObject,"drugsType")						destroyElement(drugsCrops[i].plantObject)						destroyElement(drugsCrops[i].plantObjects)						break					end				end				triggerServerEvent("farmerdrugs",hitElement,drugtype)				if isTimer(plantingTimer) then killTimer(plantingTimer) end				setElementData(localPlayer,"DrugsPlanted", getElementData(localPlayer,"DrugsPlanted") -1)			end		end	endendfunction onElementDataChange( dataName, oldValue )if dataName == "Occupation" and getElementData(localPlayer,dataName) == "Drugs farmer" then    initfarmingDrugs()elseif dataName == "Occupation" then    stopfarmingDrugs()    endendaddEventHandler ( "onClientElementDataChange", localPlayer, onElementDataChange, false )function onFarmerTeamChange ( oldTeam, newTeam )if getElementData ( localPlayer, "Occupation" ) == "Drugs farmer" and source == localPlayer then    setTimer ( function ()        if getPlayerTeam( localPlayer ) then            local newTeam = getTeamName ( getPlayerTeam( localPlayer ) )                if newTeam == "Unoccupied" then                    stopfarmingDrugs()                elseif getElementData ( localPlayer, "Occupation" ) == "Drugs farmer" and newTeam == "Criminals" then                    initfarmingDrugs()                end            end        end, 200, 1 )    endendaddEventHandler( "onClientPlayerTeamChange", localPlayer, onFarmerTeamChange, false )function onResourceStart()	setTimer ( function ()		if getPlayerTeam( localPlayer ) then			local team = getTeamName ( getPlayerTeam( localPlayer ) )			if getElementData ( localPlayer, "Occupation" ) == "Drugs farmer" and team == "Criminals" then				initfarmingDrugs()			end		end	end, 2500, 1 )endaddEventHandler ( "onClientResourceStart", getResourceRootElement(getThisResource()), onResourceStart )addEvent( "onClientPlayerTeamChange" )function initfarmingDrugs()	if not isFarmer then	isFarmer = true	endendfunction stopfarmingDrugs ()	if isFarmer then		for i=1,#drugsCrops do		if isElement(drugsCrops[i].plantObject) then destroyElement(drugsCrops[i].plantObject) end		if isElement(drugsCrops[i].plantObjects) then destroyElement(drugsCrops[i].plantObjects) end		if isTimer(drugsCrops[i].timer) then killTimer(drugsCrops[i].timer) end		if isElement(drugsCrops[i].colShape) then destroyElement(drugsCrops[i].colShape) end		setElementData(localPlayer,"DrugsPlanted", 0)		isFarmer = false		if isTimer(plantingTimer) then killTimer(plantingTimer) end		end	endend